angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","angularMoment"]);
"use strict";angular.module("RDash").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("login",{url:"/",templateUrl:"templates/login.html"}).state("check-in",{url:"/check-in",templateUrl:"templates/check-in.html"}).state("new",{url:"/new-member",templateUrl:"templates/new-member.html"}).state("info",{url:"/members-info",templateUrl:"templates/members-info.html"}).state("payment",{url:"/payment-info",templateUrl:"templates/payment-info.html"}).state("payments",{url:"/payments",templateUrl:"templates/payments.html"}).state("academy",{url:"/academy",templateUrl:"templates/academy.html"})}]);
function AcademyCtrl(e,t,n,a,i){angular.isDefined(e.credentials)&&e.credentials.valid||a.transitionTo("login"),e.section={},e.addSection=function(){var n=e.credentials;setHeaders(n.user,n.password,t,i),t.post("academy/section",e.section).then(function(){alert("Section "+e.section.name+" added")})}}angular.module("RDash").controller("AcademyCtrl",["$scope","$http","$filter","$state","Base64","moment",AcademyCtrl]);
function AdminCtrl(e,n,r,t){angular.isDefined(e.credentials)&&e.credentials.valid||r.transitionTo("login"),e.newMember={},e.newMember.joinDate=new Date,e.addMember=function(){e.alerts.push({msg:"Another alert!"})},e.submitNewMember=function(){var r=e.credentials;setHeaders(r.user,r.password,n,t),e.newMember.joinDate=new Date,n.post("members/new",e.newMember).then(function(){alert("New member "+e.newMember.firstName+" added"),e.newMember={}})},e.newMember={}}angular.module("RDash").controller("AdminCtrl",["$scope","$http","$state","Base64",AdminCtrl]);
function AlertsCtrl(l){l.closeAlert=function(r){l.alerts.splice(r,1)}}angular.module("RDash").controller("AlertsCtrl",["$scope",AlertsCtrl]);
function MasterCtrl(e,t,n,a,r,s,i){var c=992;e.getWidth=function(){return window.innerWidth},e.$watch(e.getWidth,function(n){e.toggle=n>=c?angular.isDefined(t.get("toggle"))?t.get("toggle")?!0:!1:!0:!1}),angular.isDefined(e.credentials)||a.transitionTo("login"),e.toggleSidebar=function(){e.toggle=!e.toggle,t.put("toggle",e.toggle)},window.onresize=function(){e.$apply()},e.credentials={valid:!1,user:"admin@bjj.com",password:"password"},e.login=function(){var t=e.credentials;t.valid=!0,getAcademy(t.user,t.password,r,e,i),getMembers(t.user,t.password,r,e,i),s.path("/check-in")},e.checkin=function(t){var n=e.members.indexOf(t);e.members.splice(n,1),e.checkedMembers.push(t)},e.submitMembers=function(){classAttended={members:e.checkedMembers,date:new Date,id:null},r.defaults.headers.common.Authorization="Basic "+i.encode("admin@bjj.com:password"),r.post("/classes/new",classAttended).then(function(){getMembers("admin@bjj.com","password",r,e,i),e.checkedMembers=[]})},e.selectSection=function(e,t){-1!==t.indexOf(e)?t.splice(t.indexOf(e),1):t.push(e)},e.members=[],e.checkedMembers=[],e.sortType=["lastName","firstName"],e.sortReverse=!1,e.findUser="",e.academy={},e.selectedSections=[]}function getMembers(e,t,n,a,r){setHeaders(e,t,n,r),n.get("members").then(function(e){a.members=e.data})}function getAcademy(e,t,n,a,r){setHeaders(e,t,n,r),n.get("/academies/me").then(function(e){a.academy=e.data})}function setHeaders(e,t,n,a){n.defaults.headers.common.Authorization="Basic "+a.encode(e+":"+t)}angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore","$filter","$state","$http","$location","Base64",MasterCtrl]).factory("Base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var n,a,r,s,i,c="",o="",d="",l=0;do n=t.charCodeAt(l++),a=t.charCodeAt(l++),o=t.charCodeAt(l++),r=n>>2,s=(3&n)<<4|a>>4,i=(15&a)<<2|o>>6,d=63&o,isNaN(a)?i=d=64:isNaN(o)&&(d=64),c=c+e.charAt(r)+e.charAt(s)+e.charAt(i)+e.charAt(d),n=a=o="",r=s=i=d="";while(l<t.length);return c},decode:function(t){var n,a,r,s,i,c="",o="",d="",l=0,h=/[^A-Za-z0-9\+\/\=]/g;h.exec(t)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=e.indexOf(t.charAt(l++)),s=e.indexOf(t.charAt(l++)),i=e.indexOf(t.charAt(l++)),d=e.indexOf(t.charAt(l++)),n=r<<2|s>>4,a=(15&s)<<4|i>>2,o=(3&i)<<6|d,c+=String.fromCharCode(n),64!=i&&(c+=String.fromCharCode(a)),64!=d&&(c+=String.fromCharCode(o)),n=a=o="",r=s=i=d="";while(l<t.length);return c}}});
function MemberCtrl(e,r,t,m){e.credentials.valid||t.transitionTo("login"),e.member={},e.showMember=function(r){e.member=r},e.editMember=function(){var t=e.credentials;setHeaders(t.user,t.password,r,m),r.post("members/edit",e.member).then(function(){alert("Member "+e.member.firstName+" edited")})}}angular.module("RDash").controller("MemberCtrl",["$scope","$http","$state","Base64",MemberCtrl]);
function PaymentCtrl(e,n,t,a,m,r){e.credentials.valid||(alert(e.credentials.user),a.transitionTo("login")),e.payments={},e.newPayment={},e.showPayments=function(t){var a=e.credentials,s=r().add(1,"day").format("YYYY-MM-DD");setHeaders(a.user,a.password,n,m);var y="payments/"+s+"/12/"+t.id;e.member=t,n.get(y).then(function(n){if(e.payments=n.data,0==e.payments.length){e.newPayment.memberId=t.id,e.newPayment.amount=45;var a=r().format("YYYY-MM-DD");e.newPayment.paymentDate=a;var m=r().add(1,"month").format("YYYY-MM-DD");e.newPayment.paidUntil=m}else{e.newPayment.memberId=e.payments[0].memberId,e.newPayment.amount=e.payments[0].amount;var a=r().format("YYYY-MM-DD");e.newPayment.paymentDate=a;var m=r(e.payments[0].paidUntil,"YYYY-MM-DD").add(1,"month").format("YYYY-MM-DD");e.newPayment.paidUntil=m}})},e.newPayment={},e.addPayment=function(){var t=e.credentials;setHeaders(t.user,t.password,n,m),n.post("/payments/new",e.newPayment).then(function(n){e.newPayment.id=n,e.payments.push(e.newPayment)})}}angular.module("RDash").controller("PaymentCtrl",["$scope","$http","$filter","$state","Base64","moment",PaymentCtrl]);
function AllPaymentsCtrl(e,t,a,n,r,m){angular.isDefined(e.credentials)&&e.credentials.valid||n.transitionTo("login"),e.payments={},e.paymentMembers=[],e.paymentsFrom=m().format("YYYY-MM-DD"),e.showPayments=function(){var a=e.credentials;setHeaders(a.user,a.password,t,r);var n="payments/"+e.paymentsFrom;t.get(n).then(function(t){e.payments=t.data,e.paymentMembers=[],angular.forEach(e.payments,function(t){var a=e.matchMember(t.memberId);e.paymentMembers.push({mem:a,pay:t})})})},e.matchMember=function(t){var n=a("filter")(e.members,{id:t},!0);return n.length?n[0]:void 0}}angular.module("RDash").controller("AllPaymentsCtrl",["$scope","$http","$filter","$state","Base64","moment",AllPaymentsCtrl]);
function rdLoading(){var d={restrict:"AE",template:'<div class="loading"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'};return d}angular.module("RDash").directive("rdLoading",rdLoading);
function rdWidgetBody(){var d={requires:"^rdWidget",scope:{loading:"@?",classes:"@?"},transclude:!0,template:'<div class="widget-body" ng-class="classes"><rd-loading ng-show="loading"></rd-loading><div ng-hide="loading" class="widget-content" ng-transclude></div></div>',restrict:"E"};return d}angular.module("RDash").directive("rdWidgetBody",rdWidgetBody);
function rdWidgetFooter(){var e={requires:"^rdWidget",transclude:!0,template:'<div class="widget-footer" ng-transclude></div>',restrict:"E"};return e}angular.module("RDash").directive("rdWidgetFooter",rdWidgetFooter);
function rdWidgetTitle(){var i={requires:"^rdWidget",scope:{title:"@",icon:"@"},transclude:!0,template:'<div class="widget-header"><div class="row"><div class="pull-left"><i class="fa" ng-class="icon"></i> {{title}} </div><div class="pull-right col-xs-6 col-sm-4" ng-transclude></div></div></div>',restrict:"E"};return i}angular.module("RDash").directive("rdWidgetHeader",rdWidgetTitle);
function rdWidget(){var d={transclude:!0,template:'<div class="widget" ng-transclude></div>',restrict:"EA"};return d}angular.module("RDash").directive("rdWidget",rdWidget);